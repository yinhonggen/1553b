BCConf_check      	
 !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~Ⱥ !"#$%&'()*+,-./012345678:;<=>?@ABCDEFGHIɺɺĈjdojojopqjeddmsdc;almd;mc;dm;adc,a'c;acdjodiwe0e0eܳijcosjcojcpdjcjkjdojcosjcosdjcpdjcpsjcpjdspcjpdjccoǴҴӶƷֻƷǶܡsckҴӴӶưǾ μŶֻlsamclasmcoa dsopipwid wedwe0	8e382e888888888888=djoqjda;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;sla;slcnccnn,digflyagfiwgfwgfgfkjsfhkshksdhksgdkdkagdkaiwedwieeueidscnkjkkksdkdfkfdfgiueifeueisjdadjkjkjkjkjkjkjkjkjkjkjkjkjkjkjkjkjkjkjkjkjkjkjkjkjkfffffffffffffffffffffffffeiuwoweiuoweueoepehfeuwioqwertyuiop[asdfghjkzxcvbnm,qwertyuiosdxcfvgbhnjdfghjdfghjdfghjfghfghjfghjfghjfghjfghjfghdfghfghjfghjkwertyuhjikesdrfghjkldfgvhbjrfyghjrtyuhjfghjkdfghjdfghjfghrft                                R-VN2101-5ZL-010SM-1.00 
                                             
                            ׶α       G         
                            ҳ           15       
                   
     VN2101 LinuxϵͳIOӿ
     Լʹ˵
             д       𱼗       
У                 
                   
                       
   ׼                     
ƻռ似޹˾
2016 10 08 
ܹ涨
confidentiality clause
(ϡļϡοϡϢ)鱱ƻռ似޹˾Уҽƻռ似޹˾ض;ҪԱܡκνӴͻʹøϵԱŻߵλ뱣ܺرܹ涨δ˾ϵ˵ɲй¶κ;
κθˡŻߵλܸơϣҲܽз롢򹤳ֲ̡޸Ļκϻ߲ϡϽδȨʹЩϻ߲ϡ
	These materials including, but not limited todatadatum, document, reference, informationare owned by Beijing UCAS Space Technology Co.,Ltd, and can only be used for special purpose by Beijing UCAS Space Technology Co.,Ltd.Thosematerialsmentioned above are strictly confidential.Any person, department or entity shallkeep them secret andobserve the secrecy provisions whencontacting,delivering or using these materials.Any of thesematerialsshall not be disclosed or usedin other ways without the written permission of Beijing UCAS Space Technology Co.,Ltd and the interested party submitting it.
Any person, department or entitymay not copy or reproduce thosematerials mentioned above nor may decompile, reverse engineer, disassemble, modify or create derivative works of any of these materials, or any portion thereof. Any unauthorized use of the materialsor any portion thereof is strictly prohibited.

ĵʷ¼
ĵƣVN2101 LinuxϵͳIOӿԼʹ˵
ĵţR-VN2101-5ZL-010SM-1.00
ĵڣ2016-10-08

汾	ʵʩ	д	޶ժҪ
0.09	2016-10-08	𱼗	
1.00	2016-10-11	𱼗	2016.10.10ֹ˾902󣬸ԱΪu-panļĿ¼޸Ϊu-diskSPIԷtftpļӦóܼȱ
			

?
                              Ŀ   ¼
һĿ	5
ϵͳ	5
Թ	5
ġд	5
塢Ŀ	7
5.1  SD	7
5.2  U̲	7
5.3  SPI	7
5.3.1  Ӳӷ	7
5.3.2  Է	7
5.4  CAN	8
5.4.1  Ӳӷ	8
5.4.2  CAN0	8
5.4.3  CAN1	8
5.5  ·չڲ	9
5.5.1  ڶ	9
5.5.2  Ӳӷ	9
5.5.3  Է	10
5.5.4  ղ	10
5.5.5  Ͳ	10
5.5.6  ն	10
5.5.7  ڲ	10
5.5.8  ӿ	11
5.6  TFTP	13
5.6.1  Ӳ	13
5.6.2  	13
5.6.3  	13
5.6.4  ֲ	14
5.7  Ӧó	15
 

һĿ
    ˵Ϊ˷ԣϸ̣ȫVN2101ϵͳܺܵĲԣ֤ϵͳǷҪҳ񲻷֮ìܵĵطӶƵķǿϵͳȶԣɿԡ
ϵͳ
	VN2101ƽ̨zynq XC7Z030Ϊⲿ·ڣ·SPI·CAN1553BPCIe·LVDSSDUΪ洢ƽ̨㣬ȶɿzynq XC7Z030ARMɱ FPGA ӲɱԣʵҪӲ٣ͬʱڵϸ߶ȼ CPUDSPASSP ԼźŹܡƽ̨linuxϵͳԴС񣬰ȫԸߵơ
 
ͼ 2-1
Թ
    ߡߡUSB-RS422USB-CANڵ֡
ġд
ISE Design Suite Command Prompt
xmdԴôTera TermõǰΪ115200Kbps/s,ͼ4-1ʾ
                  
                           ͼ4-1
1.xmd% cd F:/qiubenqi_work/u-boot/u-boot_boot/true_0912/test0822/vn2101_
file_0918
2.xmd% bootgen -image qspi_boot_image.bif -o i qspi_image.bin -w on
3.xmd% bootgen -image bootimage.bif -split bin -o BOOT.BIN
4.xmd% connect arm hw
5.xmd% source ps7_init.tcl
6.xmd% ps7_init
7.xmd% dow -data qspi_image.bin 0x10000000
8.xmd% dow u-boot.elf
9.xmd% con
ڴu-boot>У
10.u-boot> sf probe 0 0 0
11.u-boot> sf erase 0 0x02000000
12.u-boot> sf write 0x10000000 0 0x01FFFFFF
У1.Ϊ뵱ǰдִļĿ¼
            2.fsbl,u-boot,devicetree, uramdisk.imageۺϾļqspi_image.bin
            3.߼ļ
            4.Ӳܰ壻
            5.6. ʼ
            7.qspi_image.binRAMУ
            8.u-boot
            9.лնˣڿ̨
            10. ̽spiflashǷڣ
            11.spiflash00x02000000
            12.qspi_imageļspiflashУ
塢Ŀ
  u-diskuart_testzynq_1553b_system_wrapper.bit.binļSDС
5.1  SD
	VN2101ƽ̨УSDΪô洢ʹáϵͳSDԶļϵͳ/mntĿ¼£ն˴ӡϢʾSDĻϢûÿռСȡ
ʹcpɽSDļϵͳ࿽
5.2  U̲
    VN2101ƽ̨ʹmountUеݹصļϵͳ/mnt/u-disk岽Ϊ mkdir /mnt/u-disk ; mount /dev/sda1 /mnt/u-disk; ɽ/mnt/u-disk鿴ǷϡʹcpɽUļϵͳ࿽
5.3  SPI
    VN2101ṩ·SPIӿڣһָٵģȫ˫ͬͨߣÿ·SPIӿĸţֱSDI()SDO()SCLK(ʱ)CS(Ƭѡ)
5.3.1  Ӳӷ
	·SPIԵMISO()MOSI()ڳzynq XC7Z030ɲSCLKCSźſʵԷաͬģΪSPIԣɽSPIӿⲿ׼SPI豸ͨ豸ͨţֱʹSPIӿʹӻ֤SPIӿǷͨš
5.3.2  Է
  ն˴ָcd /mnt/u-disk/
  һ·./spidev_test -D /dev/spidev32765.0
  ·./spidev_test -D /dev/spidev32766.0
5.4  CAN
    VN2101ṩ·CANӿڣCAN0CAN1ͨźCAN_HCAN_Lʵְ˫ͨѶѭ׼CAN2.0Э飬ʵʱǿǿʵ־ֲͨѶȹܡCANϵĽڵ㲻ӣͨŷʽͬʱCANͨ˲ʵֵԵ㡢һԶ㼰ȫֹ㲥ȼַʽͽݡ
5.4.1  Ӳӷ
	ʹUSB-CANתCAN_Hzynq XC7Z030 CAN_HӿCAN_Lzynq XC7Z030 CAN_LӿҴCANλͼ5-1
 
                                ͼ 5-1  
5.4.2  CAN0
  ͨѶն˴ָcd /mnt/u-disk/can/
  Уinsmod can4linux.ko
  òʣ./baud /dev/can0 20(20ΪʣKbps/sΪλ)
  ղԣ./receive /dev/can0
  Ͳԣ./can_send -D /dev/can0 0x555 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08
5.4.3  CAN1
  òʣ./baud /dev/can1 20(20ΪʣKbps/sΪλ)
  ղԣ./receive /dev/can1
  Ͳԣ./can_send -D /dev/can1 0x555 0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08
5.5  ·չڲ
5.5.1  ڶ
    VN2101ṩ·չڣûɶ䵥··ͬʱ·չڽӿRS422Э飬·ӿĸţ·ܹ16ţòͨѶʽͨ˫߿ʵշӰȫ˫ģʽVN2101ṩͨѶΪ230.4kbps/sͨѶӿ±5-1ʾ
ͨѶ˿	UART0	UART1
	TX0_P	TX0_N	RX0_P	RX0_N	TX1_P	TX1_N	RX1_P	RX1_N
ͨѶ˿	UART2	UART3
	TX2_P	TX2_N	RX2_P	RX2_N	TX3_P	TX3_N	RX3_P	RX3_N
                               5-1
5.5.2  Ӳӷ
	USB-RS422תTX_PUARTTX_PTX_NUARTTX_NRX_PUARTRX_PRX_NUARTRX_Nһ˲USBӿڣôڵΪӦCOM˿,Ĭϲ9600bps/s,λ8λֹͣλ1λУΪNONEͼ5-2ʾ
 
                                   ͼ 5-2
5.5.3  Է
     5.5.3.1  򿪵ִڣVN2101ϵ
     5.5.3.2  LINUXնcd  /mnt
     5.5.3.3  ִ./uart_test   /dev/ttyEXT0  115200./uart_test /dev/ttyEXTx עxΪ0~3 115200ʾʣ
5.5.4  ղ
     5.5.4.1  ִcat  /dev/ttyEXT0
     5.5.4.2  ôַַôΪַ͡
5.5.5  Ͳ
         ִָecho  XXXXXXX >/dev/ttyEXT0
5.5.6  ն
         sttyڼ޸ĵǰעն˵ͨѶ
     5.5.5.1 鿴ǰڲ stty -F /dev/ttyEXT0
     5.5.5.2 ò stty -F /dev/ttyEXT0 115200(115200Ϊʵֵ)
     5.5.5.3 λ stty -F /dev/ttyEXT0 cs8 (cs8ʾ8λλ)
     5.5.5.4 ֹͣλ 
        stty -F /dev/ttyEXT0 cstopb (cstopbʾλֹͣλ)
        stty -F /dev/ttyEXT0 ~cstopb (~cstopbʾһλֹͣλ)
     5.5.5.5 У  stty -F /dev/ttyEXT0 -parenb (-parenbʾýֹУ)
5.5.7  ڲ
 
ͼ5-3
	ͼ5-3ָ˴ڵӦòĲ裬ڳʼڲֵ豣ɲֵٲڡ
5.5.8  ӿ
	ڲӿΪlinux׼Ķдread()write()Ǹûռ豸֮佻ݵҪַ豸
     5.5.8.1 򿪴豸
     int open(const str * pathname, int oflag)
     ܣļֵɹ򷵻ļ-1
     pathname򿪻򴴽ļȫ·oflag˵˺Ķѡoflag ѡO_RDONLY(ֻ)O_WRONLY(ֻд)O_RDWR(д) 
     磺fd = open("/dev/ttyEXT0",O_RDWR);
     5.5.8.2 д
	ssize_t write(int fd, const void *buf, size_t count);
	ܣ򿪵ļд ֵдɹʵдֽ-1
	 fdҪдļļbufҪдļڴдλõ׵ַcountдݵֽ
	磺
	int res; char buf = "1234"; res = write(fd,buf,5);
    5.5.8.3 
	ssize_t  read(int fd, void *buf, size_t count);
	ܣӴ򿪵ļжȡݣֵʵʶֽѶļβ0ʱ-1ssize_tϵͳͷļtypedef൱signed int
	fdҪȡļbufõڴеλõ׵ַcountܶȡֽ
	磺
	int res; char buf[5]; res = write(fd,buf,5);
	5.5.8.4 ļƫƺ
	off_t lseek(int filesdes, off_t offset, int whence)
    ܣļݶдλãֵɹµļλƣ-1
    whence ʾļƫͣѡȡѡΪSEEK_SETSEEK_CURSEEK_ENDoffsetʾƫƵľֵ
	5.5.8.5 رմ豸
	int close(int filedes)
ܣرһ򿪵ļҪرļļ
磺close_flag=close(fd);
    5.5.8.6 ʼ
ڵҪstruct termiosṹĸԱֵаʡλżУλֹͣλȣ˽ṹtermios.hС
a.
	cfsetispeed(&newtio,B115200);B115200ʾΪ115200bps/sԴ˴ڿѡB230400B115200B57600B38400B19200B9600B4800B2400B1200B600B100ʿɴ230400bps/s
b.żУ
	Уô룺
	newtio.c_cflag |=PARENB;
	newtio.c_cflag |=PARODD;
	newtio.c_iflag |=(INPCK |ISTRIP);
    żУô룺
	newtio.c_iflag |=(INPCK |ISTRIP);
	newtio.c_cflag |=PARENB
	newtio.c_cflag &=~PARODD;
c.ֹͣλ
	ֹͣλͨc_cflagеCSTOPBʵֵģֹͣλΪ1CSTOPBֹͣλΪ0,򼤻CSTOPB1λֹͣλΪnewtio.c_cflag &=~CSTOPB
d.λ
	newtio.c_cflag |=CS8CS8ʾ8λλѡCS5CS6CS7CS8ֱʾ5678λλ
5.6  tftp
	VN2101ṩһ·̫ӿڣͬʱ֧u-bootͨصķʽļVN2101ϵͳSDRAMУʸߣʹ÷㣬ȫɿļtftpʽڲ򿪲Ʒٶȿ죬ʹJTAGʽ
5.6.1  Ӳ
	VN2101ϵͳʹ߲ͬʱPCʹ߽PCԻVN2101ϵͳֱ
5.6.2  
   5.6.2.1  PCԻIPַ鿴
   a. PCԻcmd
   b. ipconfig鿴PCԻIPַ
磺PCԻIPַΪ10.0.2.10
   5.6.2.2 VN2101ϵͳIPַ
   a. ϵVN2101ϵͳ壬ʱлu-bootƽ棻
   b.  setenv ipaddr 10.0.2.15 (VN2101ϵͳIPַ)
   c.  setenv serverip 10.0.2.10 (10.0.2.10ΪPCԻIPַ)
   d. saveenvΪá
   5.6.2.3  ping
   VN2101ϵͳu-bootƽ£ping 10.0.2.10Ƿѽͨ
5.6.3  
     ͼ󣬵Show DirTftpd32:directoryļĿ¼Ի򣬵ExplorerTftpd32ļĿ¼轫ҪļĿ¼ɡ
	ǽVN2101ϵͳоͳһ˷ڲʱʹãŵڲ죬һμɽоϡVN2101ն˿̨u-boot룺
a. tftp 10000000 qfspi_image.bin
b. sf probe 0 0 0
c. sf erase 0 1ffffff
d. sf write 10000000 0 2000000
ȴɣɣϵϵͳ
5.6.4  ֲ
	ֲǽVN2101ϵͳĳһ־ļֱΪںˣ豸ļϵͳu-boot˷ΪзԱʹãŵΪֻĶֵľļٶȿ죬ɿԸߡ
    5.6.4.1 ں
VN2101ն˿̨u-boot룺
a. tftp 11300000 uImage.bin
b. sf probe 0 0 0
c. sf erase 1300000 500000
d. sf write 11300000 1300000 500000
ȴɣɣϵںˡ
    5.6.4.2 豸
VN2101ն˿̨u-boot룺
a. tftp 11800000 devicetree.dtb
b. sf probe 0 0 0
c. sf erase 1800000 20000
d. sf write 11800000 1800000 20000
ȴɣɣϵ豸
    5.6.4.3 ļϵͳ
VN2101ն˿̨u-boot룺
a. tftp 11820000 uramdisk.image.gz
b. sf probe 0 0 0
c. sf erase 1820000 7E0000
d. sf write 11820000 1820000 7E0000
ȴɣɣϵµļϵͳ
    5.6.4.4 u-boot
VN2101ն˿̨u-boot룺
a. tftp 10000000 BOOT.bin
b. sf probe 0 0 0
c. sf erase 0 100000
d. sf write 10000000 0 100000
ȴɣɣϵµu-boot
5.7  Ӧó
	ӦóûڱVN2101ƽ̨ĳ򣬴˳ʱɽ俽U̴洢ٽCPSDSDϵʱԶأٴϵʱSDӦó
磺a. mkdir /mnt/u-disk
      b. mount /dev/sda1 /mnt/u-disk
      c. cp /mnt/u-disk/uart_test /mnt/
      d. ./uart_test /dev/ttyEXT0 115200 
